<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
    <div>
        <input name="uploadFiles" type="file" multiple> <!--multiple은 파일 여러개 선택을 가능한지 체크하는 boolean-->
        <button class="uploadBtn">Upload</button>
    </div>

    <div class="uploadResult">

    </div>

    <script src="https://code.jquery.com/jquery-3.5.1.min.js"
            integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>

    <script>

        function showUploadedImage(arr) {

            console.log(arr);

            let divArea = $(".uploadResult");

            for(let i = 0; i < arr.length; i++) {
                divArea.append(`<p>${arr[i].imageURL}</p>`);
                divArea.append(`<img src='/display?fileName=${arr[i].imageURL}' style="width:100px;">`);
                //rest api상 위와 같은 ?커맨드 url은 올바르지 않으나 특수문자 문제로 올바르게 보내지지 않으므로 일단 사용
            }

        }

        $('.uploadBtn').click(function() {

            let formData = new FormData();
            // 가상의 form 객체 생성해줌

            let inputFile = $("input[type='file']");

            let files = inputFile[0].files;

            for(let i = 0; i < files.length; i++) {
                console.log(files[i]);
                formData.append("uploadFiles", files[i]);
            }
            // FormData 객체에 append(key, value)로 key-value 값을 추가 가능
            // 만약 동일 key로 append를 하면 배열로 해당 키에 value 추가
            // 세번째 파라미터로 서버에 리포트하는 파일명을 지정할 수 있다

            $.ajax({
                url: '/uploadAjax',
                processData: false,
                contentType: false, // multipart/form-data 타입을 사용하기 위해서
                data: formData,

                type: 'POST',
                dataType: 'json',
                success: function(result) {
                    console.log(result);
                    showUploadedImage(result);
                },
                error: function(jqXHR, textStatus, errorThrown) {
                    console.log(textStatus);
                }

            });
        });


    </script>
</body>
</html>